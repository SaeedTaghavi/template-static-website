function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}define(["underscore","react","react-redux","react-prop-types","../actions/index","../components/Closer.jsx","../components/Setup.jsx","../components/Export.jsx"],function(e,t,o,r,s,n,i,a){var l=s.closeComponent,c=s.setFormat,u=s.getNextBatch,m=s.fetchUsingQuery,h=s.fetchUsingIds,p=s.setCount,d=s.cancelRequest,f=s.reset,C=s.downloadFile,y=(s.getCustomFormats,function(o){function r(t){var o;_classCallCheck(this,r),o=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,t)),e.bindAll(_assertThisInitialized(o),["handleCloseClick","handleApplyClick","handleFormatChange","handleCountChange","handleCancelClick","handleGetNextClick","handleResetClick","handleDownloadFileClick","onCopyText","onCustomFormatClick"]);var s=t.dispatch;return o.updateCount=e.debounce(function(e){s(p(parseInt(e)))},500),o.onCustomFormatChange=e.debounce(function(e){s({type:"SET_CUSTOM_FORMAT",format:e})},500),o.state={count:"0",showAlert:!1,customFormatDirectEntry:!0},o}return _inherits(r,t.Component),_createClass(r,[{key:"handleDownloadFileClick",value:function(){this.props.dispatch(C())}},{key:"onCopyText",value:function(){var t=this;this.setState({showAlert:!0,alertMsg:"Text Copied!"}),e.delay(function(){return t.setState({showAlert:!1})},5e3)}},{key:"handleCloseClick",value:function(){this.props.dispatch(l())}},{key:"handleCancelClick",value:function(){this.props.dispatch(d())}},{key:"handleCountChange",value:function(e){var t=this;this.setState({count:e},function(){return t.updateCount(e)})}},{key:"handleApplyClick",value:function(){var t=this.props,o=t.dispatch,r=t.ids,s=t.query;e.isEmpty(s)&&!e.isEmpty(r)?o(h()):o(m()).done(function(){return o(h())})}},{key:"handleResetClick",value:function(){this.props.dispatch(f())}},{key:"onCustomFormatClick",value:function(){this.state.customFormatDirectEntry&&this.props.customFormats.length>0&&this.onCustomFormatChange(this.props.customFormats[0].code),this.setState({customFormatDirectEntry:!this.state.customFormatDirectEntry})}},{key:"handleFormatChange",value:function(t){var o=this.props,r=o.dispatch,s=o.formats,n=o.autoSubmit,i=e.find(s,{id:t});"custom"===i.value&&this.props.customFormats.length>0&&this.onCustomFormatChange(this.props.customFormats[0].code),r(c(i)),n&&"custom"!==i.value&&this.handleApplyClick()}},{key:"handleGetNextClick",value:function(){(0,this.props.dispatch)(u())}},{key:"componentWillReceiveProps",value:function(e){var t=e.totalRecs-e.maxCount;this.setState({count:""+e.count,hasMore:t>0,remaining:t>e.batchSize?e.batchSize:t})}},{key:"render",value:function(){var e=this.props,o=e.format,r=e.formats,s=e.isFetching,l=e.output,c=e.batchSize,u=e.showCloser,m=e.showReset,h=e.progress,p=e.maxCount,d=e.hasError,f=e.errorMsg,C=e.totalRecs,y=e.showSlider,b=e.splitCols,g=e.autoSubmit,F=e.customFormat,v=e.customFormats,k=this.state,R=k.count,E=k.hasMore,x=k.showAlert,w=k.alertMsg,_=k.remaining,S=k.customFormatDirectEntry,q=p-c,O=0===q?1:q,N=Number(R)+q,P=C>1&&y;return t.createElement("div",{className:"container-fluid export-container"},t.createElement("span",null,u&&t.createElement(n,{onClick:this.handleCloseClick}),t.createElement("div",{className:"h4"},"Exporting record(s) ",t.createElement("strong",null,O)," to"," ",t.createElement("strong",null,N)," ",t.createElement("small",null,"(total: ",C,")"))),t.createElement("div",null,t.createElement("div",{className:b?"col-sm-6":"col-sm-12"},t.createElement(i,{format:o,formats:r,disabled:s,count:R,maxCount:p,totalRecs:C,batchSize:c,hasMore:E,showSlider:P,showReset:m,autoSubmit:g,remaining:_,customFormat:F,customFormats:v,customFormatDirectEntry:S,onCustomFormatChange:this.onCustomFormatChange,onReset:this.handleResetClick,onApply:this.handleApplyClick,onCancel:this.handleCancelClick,setFormat:this.handleFormatChange,onGetNext:this.handleGetNextClick,setCount:this.handleCountChange,onCustomFormatClick:this.onCustomFormatClick}),d&&t.createElement("div",{className:"row"},t.createElement("div",{className:"col-sm-10"},t.createElement("div",{className:"alert alert-danger"},f))),x&&t.createElement("div",{className:"row"},t.createElement("div",{className:"col-sm-10"},t.createElement("div",{className:"alert alert-info"},w)))),t.createElement("div",{className:b?"col-sm-6":"col-sm-12"},t.createElement(a,{output:l,isFetching:s,progress:h,onDownloadFile:this.handleDownloadFileClick,onCopy:this.onCopyText}))))}}]),r}());y.propTypes={dispatch:r.func.isRequired,format:r.shape({id:r.string,value:r.string,label:r.string}).isRequired,formats:r.arrayOf(r.shape({id:r.string,value:r.string,label:r.string})).isRequired,isFetching:r.bool.isRequired,output:r.string.isRequired,progress:r.number.isRequired,count:r.number.isRequired,maxCount:r.number.isRequired,hasError:r.bool.isRequired,errorMsg:r.string.isRequired,batchSize:r.number.isRequired,totalRecs:r.number.isRequired,showCloser:r.bool.isRequired,showSlider:r.bool.isRequired,splitCols:r.bool.isRequired,showReset:r.bool.isRequired,autoSubmit:r.bool.isRequired};return o.connect(function(e){return{format:e.format,formats:e.formats,output:e.exports.output,isFetching:e.exports.isFetching,progress:e.exports.progress,count:e.exports.count,maxCount:e.exports.maxCount,hasError:e.error.hasError,errorMsg:e.error.errorMsg,batchSize:e.exports.batchSize,totalRecs:e.exports.totalRecs,customFormat:e.exports.customFormat,showCloser:e.main.showCloser,showSlider:e.main.showSlider,autoSubmit:e.main.autoSubmit,splitCols:e.main.splitCols,showReset:e.main.showReset,ids:e.exports.ids,query:e.main.query,customFormats:e.exports.customFormats}})(y)});