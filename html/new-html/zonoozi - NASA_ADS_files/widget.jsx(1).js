define(["jquery","underscore","backbone","react","react-dom","redux","react-redux","redux-thunk","js/widgets/base/base_widget","./reducers/index","./actions/index","./containers/App.jsx","js/components/api_query","js/components/api_targets","js/components/api_feedback","js/widgets/config"],function(t,e,r,s,i,o,a,n,u,b,h,c,f,d,x,m){var A=r.View.extend({initialize:function(t){e.assign(this,t)},render:function(){return i.render(s.createElement(a.Provider,{store:this.store},s.createElement(c,null)),this.el),this},destroy:function(){i.unmountComponentAtNode(this.el)}});return u.extend({initialize:function(t){this.options=t||{};var e=o.applyMiddleware(n.default.withExtraArgument(this)),r=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||o.compose;this.store=o.createStore(b,r(e)),this.view=new A({store:this.store}),this.defaultFormat="BibTeX",this.customFormats=[],this.bibtexKeyFormat=null,this.bibtexMaxAuthors=0,this.bibtexABSKeyFormat=null,this.bibtexABSMaxAuthors=0,this.bibtexAuthorCutoff=200,this.bibtexABSAuthorCutoff=200},activate:function(t){this.setBeeHive(t);var r=this.getPubSub(),s=this.store.dispatch,i=h.setQuery;this.activateWidget(),r.subscribe(r.INVITING_REQUEST,function(t){return s(i(t.toJSON()))}),this.attachGeneralHandler(this.onApiFeedback),r.subscribe(r.USER_ANNOUNCEMENT,e.bind(this.getFieldsFromUserData,this))},onApiFeedback:function(t){this.store.dispatch(h.requestFailed(t))},getUserData:function(){try{var t=e.isFunction(this.getBeeHive)&&this.getBeeHive(),r=e.isFunction(t.getObject)&&t.getObject("User");if(e.isPlainObject(r))return e.isFunction(r.getUserData)&&r.getUserData("USER_DATA")}catch(t){}return{}},getFieldsFromUserData:function(){var t=this,r=this.getUserData();return e.reduce(["defaultExportFormat","customFormats","bibtexKeyFormat","bibtexMaxAuthors","bibtexABSKeyFormat","bibtexABSMaxAuthors","bibtexAuthorCutoff","bibtexABSAuthorCutoff"],function(s,i){var o=e.has(r,i)?r[i]:t[i];if("defaultExportFormat"===i){var a=e.find(m.export.formats,{label:o});s[i]=a?a.value:m.export.formats[0]}else s[i]=o;return t[i]=o,s},{})},renderWidgetForCurrentQuery:function(t){var e=t.currentQuery,r=t.numFound,s=t.format,i=this.store.dispatch,o=h.fetchUsingQuery,a=h.fetchUsingIds,n=h.findAndSetFormat,u=h.hardReset,b=h.setCount,c=h.setQuery,f=h.setTotalRecs,d=h.takeSnapshot,x=h.setOrigin,m=h.setCustomFormats,A=h.setBibtexKeyFormat,l=h.setBibtexMaxAuthors,F=h.setBibtexABSKeyFormat,p=h.setBibtexABSMaxAuthors,S=h.setBibtexAuthorCutoff,g=h.setBibtexABSAuthorCutoff,B=this.getFieldsFromUserData(),E=B.customFormats,y=B.defaultFormat,C=B.bibtexMaxAuthors,v=B.bibtexKeyFormat,U=B.bibtexABSMaxAuthors,_=B.bibtexABSKeyFormat,O=B.bibtexAuthorCutoff,M=B.bibtexABSAuthorCutoff,N="default"===s||"other"===s?y:s;i(u()),i(m(E)),i(l(C)),i(p(U)),i(A(v)),i(F(_)),i(S(O)),i(g(M)),i(x(this.componentParams&&this.componentParams.origin)),i(c(e.toJSON())),i(n(s)),i(b(r)),i(f(r)),"other"!==N?(i(d()),i(o()).then(function(){return i(a()).always(function(){return i(d())})})):i(d())},closeWidget:function(){var t=this.getPubSub();t.publish(t.NAVIGATE,"results-page")},_executeApiRequest:function(e){var r=t.Deferred(),s=this.getPubSub();return s.subscribeOnce(s.DELIVERING_RESPONSE,function(t){return r.resolve(t)}),s.publish(s.EXECUTE_REQUEST,e),r.promise()},renderWidgetForListOfBibcodes:function(t,e){var r=this.store.dispatch,s=h.receiveIds,i=h.findAndSetFormat,o=h.fetchUsingIds,a=h.hardReset,n=h.setSort,u=h.setCount,b=h.setTotalRecs,c=h.takeSnapshot,f=h.setOrigin,d=h.setCustomFormats,x=h.setBibtexKeyFormat,m=h.setBibtexMaxAuthors,A=h.setBibtexABSKeyFormat,l=h.setBibtexABSMaxAuthors,F=h.setBibtexAuthorCutoff,p=h.setBibtexABSAuthorCutoff,S=this.getFieldsFromUserData(),g=S.customFormats,B=S.defaultExportFormat,E=S.bibtexMaxAuthors,y=S.bibtexKeyFormat,C=S.bibtexABSMaxAuthors,v=S.bibtexABSKeyFormat,U=S.bibtexAuthorCutoff,_=S.bibtexABSAuthorCutoff,O="default"===e.format||"other"===e.format?B:e.format,M=e.sort||"date desc, bibcode desc";r(a()),r(d(g)),r(m(E)),r(l(C)),r(x(y)),r(A(v)),r(F(U)),r(p(_)),r(n(M)),r(f(this.componentParams&&this.componentParams.origin)),r(s(t)),r(i(O.toLowerCase())),r(u(t.length)),r(b(t.length)),"other"!==e.format?r(o()).done(function(){return r(c())}):r(c())},processResponse:e.noop})});