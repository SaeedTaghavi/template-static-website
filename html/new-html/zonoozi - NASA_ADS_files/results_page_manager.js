define(["js/page_managers/controller","js/page_managers/three_column_view","hbs!js/page_managers/templates/results-page-layout","js/mixins/side_bar_manager","jquery","utils"],function(e,t,a,r,i,n){var s=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.resultsTimer=new n.TimingEvent("all-results-loaded","workflow"),this.fullResultsTimer=new n.TimingEvent("all-results-and-auxillary-loaded","workflow"),this._referrer=null},persistentWidgets:["PubtypeFacet","SearchWidget","BreadcrumbsWidget","Sort","ExportDropdown","VisualizationDropdown","AffiliationFacet","AuthorFacet","DatabaseFacet","RefereedFacet","KeywordFacet","BibstemFacet","BibgroupFacet","DataFacet","VizierFacet","GrantsFacet","Results","OrcidBigWidget","QueryInfo","GraphTabs","OrcidSelector"],activate:function(){e.prototype.activate.apply(this,arguments);var t=this.getPubSub();t.subscribe(t.START_SEARCH,_.bind(this.onStartSearch,this)),this.init()},onStartSearch:function(){this.resultsTimer.start(),this.fullResultsTimer.start()},createView:function(e){return(e=e||{}).template=e.template||a,new t({template:a})},show:function(){var t=e.prototype.show.apply(this,arguments),a=this,r=t.$el.find(".s-back-button-container");return r.empty().off("click").html('<a href="javascript:void(0);" class="back-button btn btn-sm btn-default"> <i class="fa fa-arrow-left"></i> Start New Search</a>'),r.click(function(){var e=a.getPubSub();return e.publish(e.CUSTOM_EVENT,"start-new-search"),e.publish(e.NAVIGATE,a._referrer||"index-page"),a._referrer=null,!1}),t},provideContext:function(e){e.referrer&&(this._referrer=e.referrer)},setUpIntercepts:function(){var e=this;["AuthorFacet","RefereedFacet","DatabaseFacet","GraphTabs"].map(function(t){return function(t){var a=t;t.widgets&&t.widgets.length>0&&(a=t.widgets[0]);var r=a.getPubSub(),i=r.publish;r.publish=function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];var c;t!==r.DELIVERING_REQUEST||e.getSidebarState()?i.call.apply(i,[a,t].concat(s)):(r.subscribeOnce(r.INVITING_REQUEST,function(){return window.clearTimeout(c)}),function r(){if(e.getSidebarState())return i.call.apply(i,[a,t].concat(s));c=setTimeout(function(){return requestAnimationFrame(r)},1e3)}())}}(e.widgets[t])})},assemble:function(){var t=this;return e.prototype.assemble.apply(this,arguments).done(function(){t.setUpIntercepts(),_.each(_.keys(t.widgets),function(e){t.listenTo(t.widgets[e],"page-manager-event",_.bind(t.onPageManagerEvent,t,t.widgets[e]))},t),t.setSidebarState(t._getUpdateFromUserData());var e=["Results","AuthorFacet","RefereedFacet","DatabaseFacet","GraphTabs"];try{_.forEach(_.keys(t.widgets),function(a){var r=t.widgets[a],i=function(){"Results"===a&&t.resultsTimer.stop(),_.remove(e,function(e){return e===a}),0===e.length&&t.fullResultsTimer.stop()};r.widgets&&r.widgets.length>0&&_.forEach(r.widgets,function(e){return e.onIdle=i}),r.onIdle=i})}catch(e){}})},broadcastTo:_.curry(function(e,t){var a=arguments,r=_.pick(this.widgets,e);_.each(r,function(e){e.trigger.apply(e,["page-manager-message",t].concat(_.toArray(a).slice(2)))})},2),onPageManagerEvent:function(e,t,a){"side-bars-update"===t&&this.setSidebarState(a)}});return _.extend(s.prototype,r),s});